<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-researcher</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, html {
            font-family: 'Inter', sans-serif;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
        }
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            padding: 20px 0;
            color: #ffffff;
        }
        h1 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .message {
            max-width: 80%;
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            font-size: 1em;
            line-height: 1.4;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .user-message {
            align-self: flex-end;
            background-color: #3f51b5;
            color: white;
            border-bottom-right-radius: 0;
        }
        .bot-message {
            align-self: flex-start;
            background-color: #f5f5f5;
            color: #333;
            border-bottom-left-radius: 0;
        }
        #user-input-container {
            display: flex;
            padding: 20px;
            background-color: #f0f0f0;
            border-top: 1px solid #e0e0e0;
        }
        #user-input {
            flex-grow: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        #user-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #3f51b5;
        }
        #send-button {
            margin-left: 10px;
            padding: 0 20px;
            background: #3f51b5;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #send-button:hover {
            background: #283593;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .thinking {
            align-self: center;
            font-style: italic;
            color: #888;
            background-color: #f0f0f0;
            border-radius: 15px;
            padding: 10px 15px;
            margin-bottom: 15px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        .error-message {
            align-self: center;
            background-color: #ff5252;
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
            max-width: 80%;
        }
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .action-button {
            padding: 10px 20px;
            background: #3f51b5;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .action-button:hover {
            background: #283593;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        @media (max-width: 768px) {
            #app-container {
                padding: 10px;
            }
            h1 {
                font-size: 2em;
            }
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <header>
            <h1>ðŸš€ AI-researcher</h1>
        </header>
        <div id="chat-container">
            <div id="chat-messages"></div>
            <div id="user-input-container">
                <input type="text" id="user-input" placeholder="Ask me anything...">
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>

    <script>
// Main script
const chatMessages = document.getElementById('chat-messages');
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');

let searchResults = null;
let lastAnswer = null;

function addMessage(content, isUser = false, isError = false) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');
    messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
    if (isError) messageDiv.classList.add('error-message');
    messageDiv.innerHTML = content;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function addThinkingMessage(text) {
    const thinkingDiv = document.createElement('div');
    thinkingDiv.classList.add('message', 'bot-message', 'thinking');
    thinkingDiv.textContent = text;
    chatMessages.appendChild(thinkingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return thinkingDiv;
}

function formatSourceLinks(text) {
    let counter = 1;
    return text.replace(/\[([^\]]+)\]\(([^\)]+)\)/g, (match, linkText, url) => {
        return `${linkText} ([${counter++}](${url}))`;
    });
}

async function handleUserInput() {
    const question = userInput.value.trim();
    if (question === '') return;

    addMessage(question, true);
    userInput.value = '';

    const thinkingMessage = addThinkingMessage('I am searching the web for you...');

    try {
        // Generate a single search query
        const searchQueryResponse = await axios.get('https://abhaykoul-api.hf.space/api/llm', {
            params: {
                model: 'Qwen/Qwen2-72B-Instruct',
                message: `Instructions:
                You are a smart online searcher for a large language model.
                Given information, you must create a search query to search the internet for relevant information.
                Your search query must be in the form of a JSON response.
                Exact JSON response format must be as follows:
                {
                    "search_query": "your search query"
                }
                - You must only provide ONE search query
                - You must provide the BEST search query for the given information
                - The search query must be normal text.
                - Do not include any extra information or responses, only the JSON response.

                Information: ${question}`
            }
        });

        let searchQuery;
        try {
            console.log('Search Query Response:', searchQueryResponse.data.response);
            const parsedResponse = JSON.parse(searchQueryResponse.data.response);
            if (parsedResponse && parsedResponse.search_query) {
                searchQuery = parsedResponse.search_query;
            } else {
                throw new Error('Invalid search query response format.');
            }
        } catch (parseError) {
            console.error('Failed to parse search query response:', searchQueryResponse.data.response);
            throw new Error('Failed to parse search query response.');
        }

        // Perform the search
        const searchResponse = await axios.get('https://oevortex-webscout-api.hf.space/api/websearch-and-extract-threading', {
            params: {
                q: searchQuery,
                max_results: 10,
                safesearch: 'off',
                region: 'wt-wt',
                backend: 'html',
                max_chars: 1000,
                extract_only: true
            }
        });

        searchResults = searchResponse.data;

        // Update thinking message
        thinkingMessage.textContent = 'Answering your question...';

        // Generate answer
        const answerResponse = await axios.get('https://abhaykoul-api.hf.space/api/llm', {
            params: {
                model: 'Qwen/Qwen2-72B-Instruct',
                message: `Question: ${question}\n\nSearch Results: ${JSON.stringify(searchResults)}\n\nPlease provide a comprehensive answer to the question based on the search results and webpage contents above. Include relevant webpage URLs in your answer when appropriate. If the search results and webpage contents don't contain relevant information, please state that and provide the best answer you can based on your general knowledge. [YOUR RESPONSE WITH SOURCE LINKS ([âžŠ](URL))`
            }
        });

        const answer = formatSourceLinks(answerResponse.data.response);
        lastAnswer = answer;
        thinkingMessage.remove();
        addMessage(markdownToHtml(answer));

        // Add follow-up buttons
        const followUpContainer = document.createElement('div');
        followUpContainer.classList.add('action-buttons');

        const followUpButton = document.createElement('button');
        followUpButton.classList.add('action-button');
        followUpButton.textContent = 'Ask Follow-Up Question';
        followUpButton.addEventListener('click', () => {
            userInput.placeholder = 'Ask a follow-up question...';
            userInput.focus();
        });

        const newSearchButton = document.createElement('button');
        newSearchButton.classList.add('action-button');
        newSearchButton.textContent = 'New Search';
        newSearchButton.addEventListener('click', () => {
            userInput.placeholder = 'Ask me anything...';
            userInput.focus();
            searchResults = null;
            lastAnswer = null;
        });

        followUpContainer.appendChild(followUpButton);
        followUpContainer.appendChild(newSearchButton);
        chatMessages.appendChild(followUpContainer);

    } catch (error) {
        console.error('Error:', error);
        thinkingMessage.remove();
        addMessage(error.message || 'An unexpected error occurred. Please try again.', false, true);
    }
}

function markdownToHtml(markdown) {
    // Simple Markdown to HTML conversion
    return markdown
        .replace(/^### (.+)/gm, '<h3>$1</h3>') // H3
        .replace(/^## (.+)/gm, '<h2>$1</h2>') // H2
        .replace(/^# (.+)/gm, '<h1>$1</h1>') // H1
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>') // Bold
        .replace(/\*(.+?)\*/g, '<em>$1</em>') // Italic
        .replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>') // Links
        .replace(/\n/g, '<br>'); // Line breaks
}

sendButton.addEventListener('click', handleUserInput);
userInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        handleUserInput();
    }
});

// Initial greeting
addMessage('ðŸ‘‹ Welcome to the AI-researcher! I\'m here to help you with any questions you have. Whether it\'s about the latest research, technical queries, or just general information, feel free to ask. Let\'s get started!');
    </script>
</body>
</html>
